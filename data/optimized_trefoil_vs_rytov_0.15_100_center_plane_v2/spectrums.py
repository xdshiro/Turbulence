import numpy as np
import matplotlib.pyplot as plt
import re
from scipy.io import savemat
# 19 trefoil
data_str_trefoil = """[-6, 6, 0, 6, 19, [-2.6904916875492076e-06, 1.0619259093739068e-06], [2.149056271059092e-06, -1.3361523413493029e-06], [-4.339903510991805e-07, -1.1795930317995025e-06], [4.3708079722210715e-07, -4.595710660989367e-07], [-8.28148600857055e-07, 4.3118790204306093e-07], [1.2784307175024503e-06, 1.9338512676550628e-07], [-1.7407244209637794e-07, -1.3470927700311888e-06], [-6.302973156246661e-06, -3.2352240310465644e-06], [5.974633975010299e-06, -3.2269775262747984e-06], [-1.5823552943860684e-07, 6.671885110944395e-07], [1.7612837737658517e-06, 7.205243191219663e-07], [-3.4658300302160846e-07, 9.935581506756148e-07], [1.137706857025092e-06, 6.893135483564103e-07], [-2.1267250354310073e-07, -4.183709901540878e-09], [-7.16137944153783e-06, 4.084366108887685e-06], [7.063893309743554e-07, -1.073228727803396e-06], [1.2963876391798725e-06, -5.0450905282960394e-06], [-2.8499174132363217e-06, 3.055818066263167e-06], [3.0702770012738766e-06, 6.23258754085912e-07], [3.6199603655417766e-07, -1.4170345332986737e-06], [-9.225164551183638e-07, -9.204984057329532e-07], [-1.2772260854006732e-05, 2.8058111239922636e-06], [1.3747598842691439e-05, -3.345807032202187e-07], [-1.4736089550928525e-06, 9.446684583333208e-07], [-1.2552794987376082e-06, 3.3139888144806673e-06], [-5.920656143543119e-07, -9.787318083975875e-07], [-7.826123674364786e-07, 1.0227607918731736e-06], [5.493583738581215e-07, 1.663712200874414e-07], [1.4269182215856438e-05, 6.987674706003109e-06], [-1.9382328964682207e-05, 3.3227169774062815e-07], [1.370056991531643e-05, -5.954140196189837e-06], [-5.159967938907895e-06, 5.5100778575370354e-06], [1.757867381733917e-06, -1.6651925199625643e-07], [2.8375185176622137e-07, -4.597572881823375e-08], [-7.517161278022909e-08, -6.960098545568766e-07], [-1.0671672591041506e-05, 1.567021643325257e-06], [2.6925163826703218e-05, -3.563775289551571e-06], [-1.721994313422219e-05, 1.9353188969963872e-05], [8.275731721058788e-06, -1.593601931079775e-05], [-8.765324487605978e-06, 2.9326008034785234e-07], [3.4454917491854108e-06, 3.936729454246095e-06], [9.498540335545269e-07, -2.2974784011433933e-06], [1.7808959474821625e-05, 2.3447771978716445e-06], [-5.521404412674009e-05, -8.99051267383546e-06], [8.590089352052612e-05, 1.909281673408534e-05], [-3.261572240726508e-05, -2.598773691039764e-05], [-1.055366526494416e-05, 7.0177706117914195e-06], [6.069435919969294e-06, 7.140153214804351e-06], [2.4259964675860716e-06, -4.294558440558448e-06], [5.795231429203286e-06, 1.1081016915204083e-05], [-2.2194482167047304e-05, -2.1766875416413663e-05], [3.26595268533508e-05, -9.354278076405144e-06], [-1.3704769735022957e-05, 3.255288730556863e-06], [5.510913784992353e-07, 1.7180033853281217e-06], [-9.71076029749485e-07, 2.2109438875104602e-07], [9.594714116989043e-07, 9.152940889445782e-07], [1.654430779430929e-05, 1.4805353341155329e-05], [7.984933326882054e-07, -1.3986655288697151e-05], [6.064109338318545e-06, 2.802965556430879e-06], [-2.91005132469911e-06, 2.3781796564169594e-06], [1.4824977216743647e-06, -3.011743638168214e-06], [-2.2594088833234836e-06, 1.3037020919077063e-06], [1.4778254644091858e-06, 7.063062970345296e-07], [-5.003555571197939e-05, -8.363048563070287e-06], [8.524532205010161e-06, 3.4856975876578682e-06], [5.89594992128416e-06, 3.2775111082800473e-06], [2.3113843513112978e-07, -2.278513792623414e-06], [-6.282202427252176e-07, 1.1687249732863952e-06], [4.788399446510214e-07, -6.619358039965295e-07], [-6.574418814796985e-07, 8.098844547996655e-07], [-2.3030862747998874e-05, 1.3232377781610624e-05], [-4.569626839719349e-06, 3.0639427177893126e-06], [1.8871691947289982e-06, 2.883346994953421e-06], [-1.0366135257127772e-06, 1.577183116924244e-06], [9.661422552292118e-08, -3.980650918249575e-07], [-2.1511356646076197e-06, 3.8377987895977107e-07], [3.9861700555502977e-07, 2.0765433908349047e-06], [-6.400447832249809e-06, -3.930610761906567e-06], [-7.479029508735802e-06, 8.102042910221542e-06], [3.3748336360858585e-06, 4.677703113354466e-06], [2.1582836415177523e-06, -2.6187344453797163e-06], [-2.0665001096603946e-06, -2.2173615490481287e-07], [5.661855717077509e-07, 1.0424819514779013e-06], [2.952906199441883e-07, -5.990179047461558e-07], [-6.517413312099076e-06, -8.927730292576117e-06], [1.0655128475063825e-06, 1.3795676361860849e-06], [8.51053844102909e-07, 6.707143757179547e-07], [-3.4162036396317827e-07, 8.453728766605969e-07], [9.441804532626283e-08, 2.4759146194252296e-07], [-6.154435872009232e-07, 7.370628406402789e-07], [7.543632818090644e-07, 3.175350113674744e-07]]"""

# 12 unknot
data_str_unknot = """[-6, 6, 0, 6, 12, [2.855768368417215e-06, 2.99953585075649e-06], [-9.85447671798821e-07, 1.712118210708686e-07], [2.3405372148842016e-06, 5.589428446123405e-07], [-2.0695266718829113e-06, -2.1011192998796927e-06], [-1.7959410824331557e-06, 2.1461347439988776e-06], [6.922741546236326e-07, 6.128340151220323e-07], [5.57833246478981e-07, -3.49177341040586e-07], [4.016136549651556e-06, 9.220412501536208e-06], [-4.229962048554618e-06, -1.1449920573409254e-06], [-2.0227662531354747e-06, 1.5624137513071052e-06], [-1.3955488428367262e-06, -1.949219225474429e-06], [-1.1896534935921764e-06, 6.969338676923463e-07], [5.689355975624729e-07, -2.6400074488414255e-07], [-3.559933692178151e-07, -2.0341574958214122e-07], [7.65264713584039e-06, 1.3208848571922862e-05], [-1.1093785343797926e-05, -7.07634110744716e-06], [4.891941096402769e-06, 2.391352438055874e-06], [-9.504098409278413e-07, -9.514068234975795e-07], [-8.32816678942116e-07, 8.333166776230743e-07], [3.21836325319239e-07, 6.367257758296766e-07], [6.811088752119687e-07, -1.6294340111318957e-07], [5.697708585760208e-06, 1.0376782963696094e-05], [-1.777408157633795e-05, -1.5393214516314488e-05], [1.1884120465777373e-05, 2.9450585639620953e-06], [-7.105978864670853e-07, -1.028626983447819e-06], [-5.670975674723301e-07, 7.294067267116799e-07], [-3.8425933798125416e-07, 1.0195099265222214e-06], [4.01175479175098e-07, 9.161481586779548e-07], [5.395827989646194e-06, 1.938430096716924e-05], [-1.944630153459556e-05, -3.3015952603782783e-05], [2.2663855052478802e-05, 1.308748102286189e-05], [-2.691173047622662e-06, 2.360814512417445e-06], [-2.547611218509273e-06, -1.7190909476541519e-07], [-9.979516667202497e-07, 2.3677913207005516e-06], [1.5584066836942873e-06, 1.339050822339303e-06], [2.3230306593630817e-05, 3.3420998752865045e-06], [-2.0579690825470587e-05, -6.182034117593098e-06], [1.867096161314046e-05, 1.296612134772533e-05], [-3.4857161981664653e-06, -1.1900193596008127e-05], [-6.135009152160121e-06, 4.129638689022525e-06], [4.7597204795274955e-06, 3.2269140185839536e-06], [2.5810169649723404e-07, -8.417344354732408e-07], [1.1640042579022092e-05, -2.1394284679042727e-06], [-4.1776558349379035e-05, 5.748094063413072e-06], [5.380754097619855e-05, 1.0098895032326473e-05], [-1.536939546418105e-05, -1.647947931963178e-05], [-8.554845708921325e-06, 2.169750388583612e-09], [1.4072190673112684e-06, 4.060084438136069e-06], [2.3246063302269583e-06, -3.983341596164254e-07], [-1.0708683966383057e-05, -3.1660360009672345e-06], [6.168244353258422e-05, 2.114546109069894e-05], [-5.2416313622295764e-05, 2.306161654516725e-05], [1.7382883243127536e-05, -7.826990702789693e-06], [3.129658641000795e-06, -6.158668907618945e-06], [-3.0433440199385124e-06, -1.7247237129007914e-06], [-3.750905581257765e-09, 2.4321186672944037e-06], [-2.241050903743245e-06, -2.1551749767165302e-05], [-4.382763729659235e-06, 6.199437184166685e-06], [6.709079217689875e-07, -5.821768867236342e-06], [-2.6020624603231137e-06, -1.9311773859476688e-06], [1.375252394037248e-06, 1.6947520339865054e-06], [7.406160727861843e-07, -2.450892349624404e-06], [-2.0778748815874867e-06, 5.854887180105323e-07], [-2.4784126277363134e-05, -1.994073703904709e-05], [-9.462765999198488e-07, 2.7382135971432704e-05], [-1.1062680163781934e-06, -9.45426303918428e-06], [-1.0378890225558963e-06, 4.940373097801482e-07], [-4.578120476156301e-07, 9.693671469884422e-07], [1.3845641284045437e-06, -7.540728485393029e-07], [-1.3426750337520327e-06, -1.0289329707654573e-06], [2.8491678048690974e-05, -2.7291283818208014e-05], [-1.1086290176485983e-05, -7.938034887980345e-06], [7.678939828550518e-07, 2.4202342933428183e-06], [2.3549759873480185e-06, 5.241534263984569e-07], [8.594294867126863e-07, -4.4064148805043965e-07], [2.4894192673891735e-07, -8.23728560636689e-07], [2.225643087895774e-08, 6.2337488595003e-07], [-3.225472135741973e-06, 4.3280599614630737e-07], [1.6456392392498121e-06, -1.0499870378333688e-07], [-7.621226053154907e-08, -4.135813538582335e-06], [-1.5266937675126634e-06, 2.1025886483418455e-06], [1.3137189657040576e-07, -1.6333022462231263e-06], [-1.3556744803346078e-06, 2.2726419083957794e-07], [1.4324716774797558e-07, -2.9609085638774297e-07], [1.255099355023834e-05, 4.076903417157034e-06], [-4.574791363001538e-06, -3.4024800909182972e-06], [7.75467228946657e-07, 9.384481169104311e-07], [-3.2692553969894755e-07, -4.3812368742289675e-07], [8.164595110902992e-08, -5.77145480595192e-07], [-4.451169625801873e-08, -4.9609444788913484e-08], [5.753800661352187e-07, -9.776380435679455e-07]]"""
# 2 Hopf
data_str_hopf = """[-6, 6, 0, 6, 2, [2.848347637537883e-07, -1.7608789091080013e-06], [2.909159213266551e-06, -2.8593375736125917e-07], [1.1662237937657838e-06, -3.32761978770407e-07], [-1.1314755905055637e-06, -1.5033797646981709e-06], [-5.544574353963747e-07, 1.5914925998257263e-06], [4.162062411041598e-07, -8.129749100871707e-07], [-1.4943065823780998e-06, 4.452789120981418e-07], [3.526793743972476e-06, 1.9263431591165065e-06], [-2.691061606276943e-06, 1.1761079079060468e-06], [-6.229535438489281e-07, -2.575600760563562e-07], [9.384858616057783e-07, -2.40524468522959e-07], [1.9673841052466237e-07, -6.007794487564014e-07], [-2.283364986209286e-07, 9.54916073955698e-09], [2.85243316342661e-07, -1.8336298885634307e-07], [-7.155401158017049e-07, 4.561152571853836e-06], [1.0590931751490575e-06, -2.4547230335567255e-06], [-2.71740778154357e-06, 2.898768703590824e-06], [1.508260409300784e-06, -4.0088085969079917e-07], [-1.3623682828631065e-07, -6.209661314881801e-07], [-4.3035830888626693e-07, -3.209067920377086e-07], [1.6153209054753414e-07, 2.3823181720616913e-07], [1.0448142611034544e-05, -1.1617145611620278e-05], [2.0746886914050304e-06, 9.903002581793067e-06], [-5.351340374650118e-06, -1.184325597442502e-06], [3.448251379353675e-06, 1.6666763095730434e-06], [-1.3451180399442272e-06, -5.899845001744864e-07], [8.878161907440258e-07, 1.2480182061322228e-06], [-1.9461797080550798e-07, -1.3251684119437564e-06], [-9.214590694812738e-07, 5.766278730348067e-06], [-4.0301516074402355e-06, 2.9906087883783043e-06], [-3.8089485543493984e-06, 6.44154134141601e-06], [-7.139481693512779e-07, -5.36922747174099e-06], [-1.0395008353795694e-07, 5.738412549543085e-07], [-5.842676264519842e-08, -1.3644273901123196e-06], [-7.89140642727382e-07, 4.7620192974587376e-07], [2.2586589723470866e-05, 4.534310151167537e-06], [-4.288682966443367e-05, 1.611130526317655e-05], [-9.861114260761962e-07, -3.125836188341737e-05], [1.0517472601965765e-05, 7.106422578779207e-06], [-3.084084739344273e-06, -2.239741688879231e-06], [-2.0734355944543032e-07, 2.1265141292308726e-06], [9.665379647580723e-07, 5.034071290028821e-07], [2.1883944153541045e-05, 2.6739663936954876e-05], [-6.038524015853867e-05, -4.5792638278488505e-05], [5.987373866197572e-05, 4.021017018682243e-05], [3.018939063397208e-06, -1.2140074174514516e-05], [2.1899551414344093e-06, -1.2132292735687374e-06], [-3.626101687837621e-06, -1.7104008741677354e-06], [-1.4772412222020678e-06, 1.0838520426314713e-06], [-1.6184236111531548e-06, -1.596249034742196e-05], [7.1355673432985975e-06, 3.339550155248906e-05], [-1.618866593345397e-05, -1.9271966676241142e-05], [-3.5237827087316747e-06, -9.373264886783479e-07], [-2.695000064130673e-06, 4.907286606480524e-06], [3.777739563994111e-06, 2.5035378904271293e-06], [1.0185376604456733e-06, -2.3462525211833135e-06], [-3.07072856313636e-05, -1.2613278136296976e-05], [1.4551360518035798e-05, -1.9518032298127014e-05], [-3.025004487665998e-06, 1.0787133340551118e-05], [-1.4184932653009882e-06, -2.1141412200301613e-08], [-1.0014523363296205e-06, 1.08754223526486e-06], [4.3124549263233334e-07, -8.281841685255189e-07], [-1.411257386945162e-06, -8.762689921482663e-07], [-3.136300944454141e-05, -1.989447687936956e-05], [-3.019785004749497e-05, 6.574807168098185e-06], [-1.1149895261022771e-06, -1.037696993866012e-05], [-2.518131760042165e-06, 6.195669383223286e-07], [-3.160764988520297e-07, 6.757479938128592e-07], [8.696823633200788e-07, 1.1366414137646213e-06], [5.583887877945684e-07, 5.448867441453943e-07], [1.4308283058801845e-05, 1.1130583994191237e-05], [1.4084394132322171e-05, 6.725464976933878e-06], [3.0963363870246998e-06, -2.8117285965399285e-06], [-7.38690663389747e-07, 8.502857624553684e-07], [1.5810668138105567e-06, -1.4340856495308943e-06], [-1.3895048037105556e-06, 5.597060546967105e-08], [1.0641690972124144e-06, -2.844528425477544e-07], [2.431142366124474e-06, -6.136396673685334e-06], [-2.575037681711113e-06, -7.723673778961956e-06], [1.7039645525800417e-06, -1.293759437547945e-06], [-1.843626330950855e-07, 1.1477511009798944e-07], [3.610657135287769e-07, -6.380134656739309e-07], [-9.954205541073945e-07, 1.6270776083107896e-07], [4.914478155666104e-08, 1.114209375398236e-06], [-1.8368933658370364e-06, 1.0986826401916415e-06], [2.6356573954449864e-06, 3.909953022655078e-06], [-9.365471193205213e-07, -1.024927103475832e-06], [-1.552769813260162e-06, 8.097493340968347e-07], [6.623308716110647e-07, 1.6317616713545298e-06], [5.634363968284034e-07, -4.680615560050545e-07], [1.6981524092775125e-08, 4.201847917822176e-07]]"""

data_str = data_str_unknot
i = -1
names = ['Trefoil', 'Hopf', 'Unknot']

for data_str in [data_str_trefoil, data_str_hopf, data_str_unknot]:
    i += 1

    # Use regex to extract metadata and complex values separately
    metadata = re.findall(r'\[(-?\d+),\s*(-?\d+),\s*(-?\d+),\s*(-?\d+),\s*(-?\d+)', data_str)[0]
    x_range = [int(metadata[0]), int(metadata[1])]
    y_range = [int(metadata[2]), int(metadata[3])]

    # Extract complex numbers
    complex_pairs = re.findall(r'\[([-\d.eE+]+),\s*([-\d.eE+]+)\]', data_str)
    complex_array = np.array([complex(float(re), float(im)) for re, im in complex_pairs])

    # Calculate dimensions for reshaping
    x_len = x_range[1] - x_range[0] + 1
    y_len = y_range[1] - y_range[0] + 1

    # Reshape the data into a 2D array of absolute values
    abs_values = np.abs(complex_array).reshape(x_len, y_len)

    # Save the complex array and absolute values to a .mat file
    filename = f'{names[i].lower()}_spectrum.mat'
    savemat(filename, {'complex_array': complex_array.reshape(x_len, y_len), 'abs_values': abs_values})
    print(f'Saved {filename}')

    # Plot the 2D spectrum map
    plt.figure(figsize=(8, 6))
    plt.imshow(abs_values.T, extent=(x_range[0], x_range[1], y_range[1], y_range[0]),
               aspect='auto', cmap='jet')
    plt.colorbar(label='|Value|')
    plt.title(f'2D Spectrum Map {names[i]}')
    plt.xlabel('X Axis')
    plt.ylabel('Y Axis')
    plt.show()